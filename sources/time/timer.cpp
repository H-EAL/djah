#include "time/timer.hpp"
#include "system/clock.hpp"

namespace djah { namespace time {

	//----------------------------------------------------------------------------------------------
	timer::timer(bool startNow)
		: start_time_(startNow ? getCurrentTime() : 0)
		, paused_time_(0)
		, dead_time_(0)
		, paused_(!startNow)
	{

	}
	//----------------------------------------------------------------------------------------------


	//----------------------------------------------------------------------------------------------
	void timer::restart()
	{
		start_time_	 = getCurrentTime();
		paused_time_ = 0;
		dead_time_	 = 0;
		paused_		 = false;
	}
	//----------------------------------------------------------------------------------------------


	//----------------------------------------------------------------------------------------------
	void timer::pause()
	{
		if(!paused_)
		{
			paused_time_ = getCurrentTime();
			paused_		 = true;
		}
	}
	//----------------------------------------------------------------------------------------------


	//----------------------------------------------------------------------------------------------
	void timer::unpause()
	{
		if(paused_)
		{
			dead_time_  += getCurrentTime() - paused_time_;
			paused_time_ = 0;
			paused_		 = false;
		}
	}
	//----------------------------------------------------------------------------------------------


	//----------------------------------------------------------------------------------------------
	u64 timer::getElapsedTimeMs() const
	{
		return getCurrentTime() - start_time_ - dead_time_;
	}
	//----------------------------------------------------------------------------------------------


	//----------------------------------------------------------------------------------------------
	f32 timer::getElapsedTimeSec() const
	{
		return static_cast<f32>(getElapsedTimeMs()) / 1000.0f;
	}
	//----------------------------------------------------------------------------------------------


	//----------------------------------------------------------------------------------------------
	u64 timer::getCurrentTime() const
	{
		return static_cast<u64>(system::clock::getCurrentTimeInMs());
	}
	//----------------------------------------------------------------------------------------------

} /*time*/ } /*djah*/